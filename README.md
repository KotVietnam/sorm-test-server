# Сервер для тестирования СОРМ

Этот проект представляет собой серверную часть для `sorm-test-client`. Он поднимает набор сервисов в Docker-контейнерах для приема и обработки трафика, генерируемого клиентом.

## Системные требования

*   **ОС:** Любая операционная система, поддерживающая Docker (рекомендуется Linux).
*   **Docker и Docker Compose:** Установленные и работающие.
*   **Публичный IP-адрес:** Сервер должен быть доступен извне по "белому" IP.

## Установка

### 1. Установка Docker

Если у вас не установлен Docker, следуйте официальным инструкциям:
*   [Установка Docker](https://docs.docker.com/engine/install/)
*   [Установка Docker Compose](https://docs.docker.com/compose/install/)

Для Windows или Mac можно использовать [Docker Desktop](https://www.docker.com/products/docker-desktop/).

### 2. Получение проекта

Склонируйте этот репозиторий на свой сервер:
```bash
git clone <URL репозитория>
cd sorm/sorm-test-server
```

## Настройка

Настройка сервера производится через файл `.env`. Это критически важный шаг для корректной работы VoIP-сервисов.

1.  В папке `sorm-test-server` создайте файл с именем `.env`.
2.  Добавьте в него следующие строки:

    ```env
    # Имя проекта для Docker Compose (можно оставить по умолчанию)
    COMPOSE_PROJECT_NAME=sorm

    # Внешний IP-адрес сервера. Замените на ваш "белый" IP.
    EXTERNAL_IP=XXX.XXX.XXX.XXX
    ```

3.  **Обязательно** замените `XXX.XXX.XXX.XXX` на реальный публичный IP-адрес вашего сервера. Этот IP-адрес будет использоваться Asterisk и другими сервисами для правильной маршрутизации медиатрафика (RTP).

## Использование

Все команды выполняются в директории `sorm-test-server`.

### Запуск сервера

Для запуска всех сервисов в фоновом режиме выполните:
```bash
docker-compose up -d
```

### Проверка состояния

Чтобы убедиться, что все контейнеры запустились и работают, используйте команду:
```bash
docker-compose ps
```
Вы должны увидеть список сервисов со статусом `Up` или `running`.

### Просмотр логов

Для просмотра логов всех сервисов в реальном времени:
```bash
docker-compose logs -f
```
Чтобы посмотреть логи конкретного сервиса (например, `asterisk`):
```bash
docker-compose logs -f asterisk
```

### Остановка сервера

Для остановки и удаления всех контейнеров, связанных с проектом:
```bash
docker-compose down
```

## Предоставляемые сервисы

`docker-compose` запускает следующие сервисы для эмуляции реальной сетевой инфраструктуры:

| Сервис в `docker-compose.yml` | Программное обеспечение | Обрабатываемые протоколы |
|-------------------------------|-------------------------|--------------------------|
| `nginx`                       | Nginx                   | HTTP, HTTPS, WebMail (прокси) |
| `asterisk`                    | Asterisk                | SIP, H.323, IAX2, MGCP, Skinny, RTP |
| `prosody`                     | Prosody                 | XMPP (Jabber)            |
| `ngircd`                      | ngIRCd                  | IRC                      |
| `freeradius`                  | FreeRADIUS              | RADIUS                   |
| `ftp`                         | vsftpd                  | FTP                      |
| `postfix`                     | Postfix                 | SMTP                     |
| `dovecot`                     | Dovecot                 | IMAP, POP3               |
| `telnetd`                     | Telnetd                 | Telnet                   |